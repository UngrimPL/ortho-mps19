<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <title>Orto + dzia≈Çki</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <style>
    html, body, #map { height: 100%; margin: 0; }
    .label {
      font: 12px/12px "Segoe UI", Arial, sans-serif;
      background: rgba(255,255,255,0.75);
      padding: 0 3px;
      border-radius: 3px;
      white-space: nowrap;
      border: 1px solid rgba(0,0,0,0.2);
    }
    .legend {
      position: absolute; bottom: 12px; right: 12px; 
      background: rgba(255,255,255,.9); padding: 8px 10px; 
      border-radius: 8px; font: 13px/16px Arial;
      box-shadow: 0 2px 8px rgba(0,0,0,.15);
    }
  </style>
</head>
<body>
<div id="map"></div>
<div class="legend">
  <div><b>Warstwy:</b></div>
  <div>üó∫Ô∏è Orto (XYZ tiles)</div>
  <div>üìê Dzia≈Çki (GeoJSON) + etykiety</div>
</div>
<script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
  crossorigin="">
</script>
<script src="https://unpkg.com/leaflet-hash"></script>

<script>
  // 1) Mapa startowa
  const map = L.map('map', { zoomControl: true }).setView([51.94, 20.62], 15); // ustaw na sw√≥j obszar
  const hash = new L.Hash(map); // permalink w adresie

  // 2) Orto z lokalnych kafelk√≥w
  const ortho = L.tileLayer('./tiles/{z}/{x}/{y}.png', {
    minZoom: 0, maxZoom: 22, attribution: '&copy; ortofotomapa ‚Äì Twoje dane'
  }).addTo(map);

  // 3) Wektor dzia≈Çek + styl + etykiety
  let parcelsLayer;

  function styleParcels() {
    return {
      color: '#ff6600',
      weight: 1,
      opacity: 0.9,
      fillOpacity: 0.05
    };
  }

  // Funkcja etykietujƒÖca ‚Äì DivIcon na centroidzie
  function addLabel(feature, layer) {
    if (!feature.properties) return;
    const nr = feature.properties.nr_dz || feature.properties.nr || feature.properties.NUMER || '';
    if (!nr) return;

    // centroid warstwy (dla polygonu)
    const center = layer.getBounds().getCenter();
    const icon = L.divIcon({ className: 'label', html: nr });
    const marker = L.marker(center, { icon, interactive: false, pane: 'markerPane' });
    marker.addTo(map);
  }

  fetch('./parcels.geojson')
    .then(r => r.json())
    .then(geojson => {
      parcelsLayer = L.geoJSON(geojson, {
        style: styleParcels,
        onEachFeature: (feature, layer) => {
          // tooltip / popup
          const nr = feature.properties.nr_dz || feature.properties.nr || feature.properties.NUMER || '‚Äî';
          layer.bindPopup(`<b>Dzia≈Çka:</b> ${nr}`);
          // etykieta
          addLabel(feature, layer);
        }
      }).addTo(map);

      try {
        map.fitBounds(parcelsLayer.getBounds(), { padding: [30, 30] });
      } catch(e) {}
    });

  // 4) Prze≈ÇƒÖczanie warstw (je≈õli dorzucisz wiƒôcej)
  L.control.scale({ metric: true, imperial: false }).addTo(map);
</script>
</body>
</html>
