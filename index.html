<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <title>Orto s19 – Zabezpieczone</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet">
  <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
  <script src="https://unpkg.com/pmtiles@3.0.6/dist/pmtiles.js"></script>
  <style>
    html,body,#map{height:100%;margin:0;background:#eaeaea}
    .toast{position:absolute;top:10px;left:10px;background:#fff;padding:8px 12px;
           border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,.15);font:13px system-ui;z-index:10}
  </style>
</head>
<body>
  <div id="map"></div>
  <div id="toast" class="toast">Ładuję…</div>

  <script>
    // --- proste hasło ---
    const PASSWORD = "MP-S19"; // <- zmień tu
    const input = prompt("Podaj hasło, aby wyświetlić mapę:");
    if (input !== PASSWORD) {
      document.body.innerHTML = "<h2 style='font-family:sans-serif;text-align:center;margin-top:40vh'>Nieprawidłowe hasło ❌</h2>";
      throw new Error("Unauthorized");
    }

    // --- konfiguracja PMTiles ---
    const PMTILES_URL = "https://pub-ceaa84cce5f04dc9bc703ca491dfbe8a.r2.dev/ms19.pmtiles";
    const protocol = new pmtiles.Protocol();
    maplibregl.addProtocol("pmtiles", protocol.tile);
    const p = new pmtiles.PMTiles(PMTILES_URL);
    protocol.add(p);

    const map = new maplibregl.Map({
      container: "map",
      style: { version: 8, sources: {}, layers: [] },
      center: [22.735, 52.081],
      zoom: 17
    });
    map.addControl(new maplibregl.NavigationControl(), "top-left");
    map.addControl(new maplibregl.ScaleControl({ unit: "metric" }));

    map.on("load", () => {
      map.addSource("ortho", {
        type: "raster",
        url: `pmtiles://${PMTILES_URL}`,
        tileSize: 256
      });
      map.addLayer({ id: "ortho", type: "raster", source: "ortho" });
      document.getElementById("toast").textContent = "Załadowano źródło z R2 ✅";
      setTimeout(()=>document.getElementById("toast").remove(),3000);
    });
  </script>
</body>
</html>
